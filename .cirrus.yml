task:
    freebsd_instance:
      cpu: 4
      memory: 16G
      matrix:
        - image: freebsd-13-1-release-amd64
        # image: freebsd-14-0-current-amd64-v20220701

    env:
      CIRRUS_CLONE_DEPTH: 1
      GITHUB_TOKEN: ENCRYPTED[53a7e28d3a96e84dcfc38da4df73c32521b000794598caa1de582dda1afee5fab653d43f80d86f7fd1713f81581eee38]
      BATCH: 1 

    timeout_in: 90m

    prerequisites_script:
      - ASSUME_ALWAYS_YES=yes pkg bootstrap -f
      - pkg install -y git-lite
      # Only download ports infrastructure but no ports; https://stackoverflow.com/a/52269934/2988
      # rm -rf /usr/ports
      # git clone --depth 1 --filter=blob:none --sparse https://github.com/freebsd/freebsd-ports.git /usr/ports
      # ( cd /usr/ports ; git sparse-checkout set Keywords Mk Templates Tools ; cd - )
      - mkdir -p ./pkg/
      
    launch_script:
      - pkg install -y curl wget zip pkgconf cmake qt5-qmake qt5-widgets qt5-buildtools qt5-sql kf5-kwindowsystem databases/qt5-sqldrivers-sqlite3
      - make -C sysutils/hellodesktop-launch package

    Menu_script:
      - pkg install -y curl wget zip pkgconf cmake qt5-x11extras qt5-quickcontrols qt5-qmake qt5-widgets qt5-buildtools qt5-concurrent kf5-kdbusaddons kf5-kwindowsystem kf5-baloo libdbusmenu-qt5 pulseaudio pulseaudio-qt libXcomposite
      - make -C x11-wm/hellodesktop-menu package

    Filer_script:
      - pkg install -y git-lite curl wget zip cmake pkgconf libfm qt5-core qt5-x11extras qt5-widgets qt5-qmake qt5-buildtools qt5-linguisttools qt5-multimedia
      - make -C x11-fm/hellodesktop-filer package

    gmenudbusmenuproxy-standalone_script:
      - ln -sf $(readlink -f ./x11-fm/hellodesktop-filer) /usr/ports/x11-fm/
      - ln -sf $(readlink -f ./x11-wm/hellodesktop-menu) /usr/ports/x11-wm/
      - ln -sf $(readlink -f ./sysutils/hellodesktop-qtplugin) /usr/ports/sysutils/
      - ln -sf $(readlink -f ./sysutils/hellodesktop-icons) /usr/ports/sysutils/
      - make -C x11/gmenudbusmenuproxy-standalone package

    helloDesktop_script:
      - make -C x11-wm/hellodesktop package
      
    package_script:
      - find . -name '*.pkg' -exec mv {} ./pkg \;
      
    binary_artifacts:
      path: "pkg/*"
